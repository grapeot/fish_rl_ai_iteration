# Fish RL 开发 SOP

## 终极目标
- 在最具挑战的配置（捕食者速度快、数量多的小鱼、动作受限）下，训练出的策略仍能让绝大多数小鱼完成整局存活。
- 每次迭代都可复现：包含代码版本、训练参数、日志、曲线和检查点。
- 任意时刻可以回溯至某个 `dev_vX.md` 了解背景、假设和下一步计划。

## 工作流
1. **观察 & 记录现状**
   - 使用最新的 `train_vX.py` 在基准配置跑一次（必要时先跑小规模 sanity run）。
   - 汇总关键指标：平均/终局存活率、奖励、损失、熵等；若判断困难，优先开 TensorBoard（`tensorboard --logdir tb_logs`）或解析 JSON/纯文本日志。

2. **撰写 `dev_vX.md` 草稿**
   - 结构：背景、观察、假设、待验证问题、下一步计划。
   - 坦诚记录不确定性；如结论尚不清楚，列出需要额外 log/实验的清单。

3. **增加可观测性（如有需要）**
   - 先在代码里添加轻量日志/metrics/TensorBoard scalar，确保能定位问题。
   - 相关改动记入当期 `dev_vX.md`（“已修复”或 “TODO”）。

4. **实施改动与验证**
   - 先跑小规模测试（例：少量 iteration、减小并行数），确认逻辑正确、指标朝预期方向变化。
   - 小规模通过后，再跑目标规模实验；保持 checkpoints 与训练曲线“只读”式保存：
     - 代码版本：`train_v{X+1}.py`，描述改动。
     - 输出目录：`checkpoints/v{X+1}/...`，不可覆盖旧结果。
     - 绘制 `checkpoints/v{X+1}/training_curve.png`，附带参数摘要与平均存活率走向。

5. **归档与可追溯性**
   - 提交代码、`dev_vX.md`、SOP 变更、依赖更新等，保证仓库状态即可重跑。
   - 在提交信息和 `dev_vX.md` 中标注对应输出路径（logs、checkpoints、曲线）。

## 约定
- 任何 Python 操作前检查/创建/激活 `uv` 虚拟环境，并用 `uv pip install` 管理依赖。
- 日志渠道可混用（TensorBoard、文本、JSON）；但每轮至少保存一种易于 diff 的格式。
- `train_vX.py` 与 `dev_vX.md` 的版本号保持同步：一次 major 迭代 +1。
- `checkpoints/` 下的历史模型视为不可变，只追加新目录。
